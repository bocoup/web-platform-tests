
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Stash &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="wptserve Pipes" href="../../../writing-tests/server-pipes.html" />
    <link rel="prev" title="Response" href="response.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="stash">
<h1>Stash<a class="headerlink" href="#stash" title="Permalink to this headline">¶</a></h1>
<p>Object for storing cross-request state. This is unusual in that keys
must be UUIDs, in order to prevent different clients setting the same
key, and values are write-once, read-once to minimize the chances of
state persisting indefinitely. The stash defines two operations;
<cite>put</cite>, to add state and <cite>take</cite> to remove state. Furthermore, the view
of the stash is path-specific; by default a request will only see the
part of the stash corresponding to its own path.</p>
<p>A typical example of using a stash to store state might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@handler</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="c1"># We assume this is a string representing a UUID</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stash</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;Some sample value&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Added value to stash&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stash</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stash</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">key</span>
</pre></div>
</div>
<div class="section" id="module-wptserve.stash">
<span id="interface"></span><h2><a class="reference internal" href="#module-wptserve.stash" title="wptserve.stash"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Interface</span></code></a><a class="headerlink" href="#module-wptserve.stash" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="wptserve.stash.ClientDictManager">
<em class="property">class </em><code class="descclassname">wptserve.stash.</code><code class="descname">ClientDictManager</code><span class="sig-paren">(</span><em>address=None</em>, <em>authkey=None</em>, <em>serializer='pickle'</em><span class="sig-paren">)</span><a class="headerlink" href="#wptserve.stash.ClientDictManager" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="wptserve.stash.ServerDictManager">
<em class="property">class </em><code class="descclassname">wptserve.stash.</code><code class="descname">ServerDictManager</code><span class="sig-paren">(</span><em>address=None</em>, <em>authkey=None</em>, <em>serializer='pickle'</em><span class="sig-paren">)</span><a class="headerlink" href="#wptserve.stash.ServerDictManager" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="wptserve.stash.Stash">
<em class="property">class </em><code class="descclassname">wptserve.stash.</code><code class="descname">Stash</code><span class="sig-paren">(</span><em>default_path</em>, <em>address=None</em>, <em>authkey=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wptserve.stash.Stash" title="Permalink to this definition">¶</a></dt>
<dd><p>Key-value store for persisting data across HTTP/S and WS/S requests.</p>
<p>This data store is specifically designed for persisting data across server
requests. The synchronization is achieved by using the BaseManager from
the multiprocessing module so different processes can acccess the same data.</p>
<p>Stash can be used interchangeably between HTTP, HTTPS, WS and WSS servers.
A thing to note about WS/S servers is that they require additional steps in
the handlers for accessing the same underlying shared data in the Stash.
This can usually be achieved by using load_env_config(). When using Stash
interchangeably between HTTP/S and WS/S request, the path part of the key
should be expliclitly specified if accessing the same key/value subset.</p>
<p>The store has several unusual properties. Keys are of the form (path,
uuid), where path is, by default, the path in the HTTP request and
uuid is a unique id. In addition, the store is write-once, read-once,
i.e. the value associated with a particular key cannot be changed once
written and the read operation (called “take”) is destructive. Taken together,
these properties make it difficult for data to accidentally leak
between different resources or different requests for the same
resource.</p>
<dl class="method">
<dt id="wptserve.stash.Stash.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>key</em>, <em>value</em>, <em>path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wptserve.stash.Stash.put" title="Permalink to this definition">¶</a></dt>
<dd><p>Place a value in the shared stash.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> – A UUID to use as the data’s key.</li>
<li><strong>value</strong> – The data to store. This can be any python object.</li>
<li><strong>path</strong> – The path that has access to read the data (by default
the current request path)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wptserve.stash.Stash.take">
<code class="descname">take</code><span class="sig-paren">(</span><em>key</em>, <em>path=None</em><span class="sig-paren">)</span><a class="headerlink" href="#wptserve.stash.Stash.take" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a value from the shared stash and return it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> – A UUID to use as the data’s key.</li>
<li><strong>path</strong> – The path that has access to read the data (by default
the current request path)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="wptserve.stash.StashError">
<em class="property">exception </em><code class="descclassname">wptserve.stash.</code><code class="descname">StashError</code><a class="headerlink" href="#wptserve.stash.StashError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../writing-tests/index.html">Writing Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/general-guidelines.html">General Test Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/ahem.html">The Ahem Font</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/assumptions.html">Test Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/css-metadata.html">CSS Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/css-user-styles.html">CSS User Stylesheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/file-names.html">File Name Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/h2tests.html">Writing H2 Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/lint-tool.html">Lint Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/manual.html">Manual Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/reftest-tutorial.html">Writing a reftest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/reftests.html">Reftests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/rendering.html">Rendering Test Guidelines</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../writing-tests/server-features.html">Server Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/submission-process.html">Submitting Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/testdriver.html">testdriver.js Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/testdriver-tutorial.html">testdriver.js Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/testharness.html">testharness.js Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/tools.html">Command-line utility scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/visual.html">Visual Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/wdspec.html">wdspec tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/test-templates.html">Test Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/github-intro.html">Introduction to GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/index.html#test-type">Test Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../writing-tests/index.html#submitting-tests">Submitting Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin/index.html">Project Administration</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../writing-tests/index.html">Writing Tests</a><ul>
  <li><a href="../../../writing-tests/server-features.html">Server Features</a><ul>
  <li><a href="../../../writing-tests/python-handlers/index.html">Python Handlers</a><ul>
      <li>Previous: <a href="response.html" title="previous chapter">Response</a></li>
      <li>Next: <a href="../../../writing-tests/server-pipes.html" title="next chapter">wptserve Pipes</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, wpt contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/tools/wptserve/docs/stash.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>