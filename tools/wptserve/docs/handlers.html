
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Handlers &#8212; web-platform-tests  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Pipes" href="pipes.html" />
    <link rel="prev" title="Router" href="router.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="handlers">
<h1>Handlers<a class="headerlink" href="#handlers" title="Permalink to this headline">¶</a></h1>
<p>Handlers are functions that have the general signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>It is expected that the handler will use information from
the request (e.g. the path) either to populate the response
object with the data to send, or to directly write to the
output stream via the ResponseWriter instance associated with
the request. If a handler writes to the output stream then the
server will not attempt additional writes, i.e. the choice to write
directly in the handler or not is all-or-nothing.</p>
<p>A number of general-purpose handler functions are provided by default:</p>
<div class="section" id="python-handlers">
<span id="handlers-python"></span><h2>Python Handlers<a class="headerlink" href="#python-handlers" title="Permalink to this headline">¶</a></h2>
<p>Python handlers are functions which provide a higher-level API over
manually updating the response object, by causing the return value of
the function to provide (part of) the response. There are four
possible sets of values that may be returned:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">status_code</span><span class="p">,</span> <span class="n">reason</span><span class="p">),</span> <span class="n">headers</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="p">(</span><span class="n">status_code</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<span class="n">content</span>
</pre></div>
</div>
<p>Here <cite>status_code</cite> is an integer status code, <cite>headers</cite> is a list of (field
name, value) pairs, and <cite>content</cite> is a string or an iterable returning strings.
Such a function may also update the response manually. For example one may use
<cite>response.headers.set</cite> to set a response header, and only return the content.
One may even use this kind of handler, but manipulate the output socket
directly, in which case the return value of the function, and the properties of
the response object, will be ignored.</p>
<p>The most common way to make a user function into a python handler is
to use the provided <cite>wptserve.handlers.handler</cite> decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wptserve.handlers</span> <span class="k">import</span> <span class="n">handler</span>

<span class="nd">@handler</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;X-Test&quot;</span><span class="p">:</span> <span class="s2">&quot;PASS&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">)],</span> <span class="s2">&quot;test&quot;</span>

<span class="c1">#Later, assuming we have a Router object called &#39;router&#39;</span>

<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;/test&quot;</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="json-handlers">
<h2>JSON Handlers<a class="headerlink" href="#json-handlers" title="Permalink to this headline">¶</a></h2>
<p>This is a specialisation of the python handler type specifically
designed to facilitate providing JSON responses. The API is largely
the same as for a normal python handler, but the <cite>content</cite> part of the
return value is JSON encoded, and a default Content-Type header of
<cite>application/json</cite> is added. Again this handler is usually used as a
decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wptserve.handlers</span> <span class="k">import</span> <span class="n">json_handler</span>

<span class="nd">@json_handler</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;PASS&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="python-file-handlers">
<h2>Python File Handlers<a class="headerlink" href="#python-file-handlers" title="Permalink to this headline">¶</a></h2>
<p>Python file handlers are Python files which the server executes in response to
requests made to the corresponding URL. This is hooked up to a route like
<code class="docutils literal notranslate"><span class="pre">(&quot;*&quot;,</span> <span class="pre">&quot;*.py&quot;,</span> <span class="pre">python_file_handler)</span></code>, meaning that any .py file will be
treated as a handler file (note that this makes it easy to write unsafe
handlers, particularly when running the server in a web-exposed setting).</p>
<p>The Python files must define a single function <cite>main</cite> with the signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>This function then behaves just like those described in
<a class="reference internal" href="#handlers-python"><span class="std std-ref">Python Handlers</span></a> above.</p>
</div>
<div class="section" id="asis-handlers">
<h2>asis Handlers<a class="headerlink" href="#asis-handlers" title="Permalink to this headline">¶</a></h2>
<p>These are used to serve files as literal byte streams including the
HTTP status line, headers and body. In the default configuration this
handler is invoked for all files with a .asis extension.</p>
</div>
<div class="section" id="file-handlers">
<h2>File Handlers<a class="headerlink" href="#file-handlers" title="Permalink to this headline">¶</a></h2>
<p>File handlers are used to serve static files. By default the content
type of these files is set by examining the file extension. However
this can be overridden, or additional headers supplied, by providing a
file with the same name as the file being served but an additional
.headers suffix, i.e. test.html has its headers set from
test.html.headers. The format of the .headers file is plaintext, with
each line containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Header</span><span class="o">-</span><span class="n">Name</span><span class="p">:</span> <span class="n">header_value</span>
</pre></div>
</div>
<p>In addition headers can be set for a whole directory of files (but not
subdirectories), using a file called <cite>__dir__.headers</cite>.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">web-platform-tests</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../test-suite-design.html">Test Suite Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../running-tests/index.html">Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../writing-tests/index.html">Writing Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reviewing-tests/index.html">Reviewing Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../admin/index.html">Project Administration</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../admin/index.html#tooling">Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../admin/index.html#secrets">Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../admin/index.html#third-party-account-owners">Third-party account owners</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../admin/index.html">Project Administration</a><ul>
  <li><a href="index.html">Web Platform Test Server</a><ul>
      <li>Previous: <a href="router.html" title="previous chapter">Router</a></li>
      <li>Next: <a href="pipes.html" title="next chapter">Pipes</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, wpt contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/tools/wptserve/docs/handlers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>